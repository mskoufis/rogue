

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Testing The Custom Module &mdash; Rogue v5.6.5-27-g2069c8d1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Installing &amp; Compiling Rogue" href="../installing/index.html" />
    <link rel="prev" title="Wrapping Custom Module With PyRogue Device" href="wrapper.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Rogue
          

          
          </a>

          
            
            
              <div class="version">
                v5.6.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../interfaces/index.html">Interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hardware/index.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/index.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../protocols/index.html">Protocols</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging/index.html">Logging In Rogue</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Creating Custom Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sourcefile.html">Custom Module Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="makefile.html">Building The Custom Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="wrapper.html">Wrapping Custom Module With PyRogue Device</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Testing The Custom Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#testing-with-epics">Testing With EPICS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-with-a-gui">Testing With A GUI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installing/index.html">Installing &amp; Compiling Rogue</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Rogue</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Creating Custom Modules</a> &raquo;</li>
        
      <li>Testing The Custom Module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/custom_module/testing.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="testing-the-custom-module">
<span id="custom-testing"></span><h1>Testing The Custom Module<a class="headerlink" href="#testing-the-custom-module" title="Permalink to this headline">Â¶</a></h1>
<p>The following script tests the MyModule and MyWrapper implementations created
by the <a class="reference internal" href="sourcefile.html#custom-sourcefile"><span class="std std-ref">Custom Module Source</span></a>, <a class="reference internal" href="makefile.html#custom-makefile"><span class="std std-ref">Building The Custom Module</span></a> and <a class="reference internal" href="wrapper.html#custom-wrapper"><span class="std std-ref">Wrapping Custom Module With PyRogue Device</span></a> steps.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Source for myTest.py</span>

<span class="kn">import</span> <span class="nn">pyrogue</span>
<span class="kn">import</span> <span class="nn">MyWrapper</span>

<span class="k">class</span> <span class="nc">TestRoot</span><span class="p">(</span><span class="n">pyrogue</span><span class="o">.</span><span class="n">Root</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyRoot&quot;</span><span class="p">)</span>

        <span class="c1"># Add master and slave devices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyWrapper</span><span class="o">.</span><span class="n">MyCustomMaster</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;testMaster&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyWrapper</span><span class="o">.</span><span class="n">MyCustomSlave</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;testSlave&quot;</span><span class="p">))</span>

        <span class="c1"># Connect master to slave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testMaster</span> <span class="o">&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">testSlave</span>

        <span class="c1"># Start the tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">with</span> <span class="n">TestRoot</span><span class="p">()</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>

    <span class="c1"># Set frame size to 200</span>
    <span class="n">r</span><span class="o">.</span><span class="n">testMaster</span><span class="o">.</span><span class="n">FrameSize</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>

    <span class="c1"># Generate 2 Frames</span>
    <span class="n">r</span><span class="o">.</span><span class="n">testMaster</span><span class="o">.</span><span class="n">MyFrameGen</span><span class="p">()</span>
    <span class="n">r</span><span class="o">.</span><span class="n">testMaster</span><span class="o">.</span><span class="n">MyFrameGen</span><span class="p">()</span>

    <span class="c1"># Display status</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sent </span><span class="si">{}</span><span class="s2"> bytes in </span><span class="si">{}</span><span class="s2"> frames&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">testMaster</span><span class="o">.</span><span class="n">ByteCount</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span><span class="n">r</span><span class="o">.</span><span class="n">testMaster</span><span class="o">.</span><span class="n">FrameCount</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Got  </span><span class="si">{}</span><span class="s2"> bytes in </span><span class="si">{}</span><span class="s2"> frames&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">testSlave</span><span class="o">.</span><span class="n">ByteCount</span><span class="o">.</span><span class="n">get</span><span class="p">(),</span><span class="n">r</span><span class="o">.</span><span class="n">testSlave</span><span class="o">.</span><span class="n">FrameCount</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span>
</pre></div>
</div>
<p>The output of this python script should be the following (with a different rogue version):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python myTest.py
Rogue/pyrogue version v3.2.1. https://github.com/slaclab/rogue
Loaded my module
Sent 400 bytes in 2 frames
Got  400 bytes in 2 frames
</pre></div>
</div>
<div class="section" id="testing-with-epics">
<h2>Testing With EPICS<a class="headerlink" href="#testing-with-epics" title="Permalink to this headline">Â¶</a></h2>
<p>The following scripts is similiar to the above but exposes the variables
to epics to allow external control.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Source for myEpicsTest.py</span>

<span class="kn">import</span> <span class="nn">pyrogue</span>
<span class="kn">import</span> <span class="nn">MyWrapper</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pyrogue.protocols.epics</span>

<span class="k">class</span> <span class="nc">TestRoot</span><span class="p">(</span><span class="n">pyrogue</span><span class="o">.</span><span class="n">Root</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyRoot&quot;</span><span class="p">)</span>

        <span class="c1"># Add master and slave devices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyWrapper</span><span class="o">.</span><span class="n">MyCustomMaster</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;testMaster&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyWrapper</span><span class="o">.</span><span class="n">MyCustomSlave</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;testSlave&quot;</span><span class="p">))</span>

        <span class="c1"># Connect master to slave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testMaster</span> <span class="o">&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">testSlave</span>

        <span class="c1"># Start the tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Add Epics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epics</span> <span class="o">=</span> <span class="n">pyrogue</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">epics</span><span class="o">.</span><span class="n">EpicsCaServer</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="s1">&#39;myTest&#39;</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epics</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epics</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>

    <span class="c1"># Override root class stop method to stop epics on exit</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epics</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="k">with</span> <span class="n">TestRoot</span><span class="p">()</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exiting&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Start the above script and generate frames using epics caput commands. You can also
monitor the counters as well. See below for an example:</p>
<p>In the first terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python myEpicsTest.py
Rogue/pyrogue version v3.3.1-4-gd384a633. https://github.com/slaclab/rogue
Loaded my module
myTest:MyRoot:enable -&gt; MyRoot.enable
myTest:MyRoot:SystemLog -&gt; MyRoot.SystemLog
myTest:MyRoot:ForceWrite -&gt; MyRoot.ForceWrite
myTest:MyRoot:Time -&gt; MyRoot.Time
myTest:MyRoot:WriteAll -&gt; MyRoot.WriteAll
myTest:MyRoot:ReadAll -&gt; MyRoot.ReadAll
myTest:MyRoot:WriteState -&gt; MyRoot.WriteState
myTest:MyRoot:WriteConfig -&gt; MyRoot.WriteConfig
myTest:MyRoot:ReadConfig -&gt; MyRoot.ReadConfig
myTest:MyRoot:SoftReset -&gt; MyRoot.SoftReset
myTest:MyRoot:HardReset -&gt; MyRoot.HardReset
myTest:MyRoot:CountReset -&gt; MyRoot.CountReset
myTest:MyRoot:ClearLog -&gt; MyRoot.ClearLog
myTest:MyRoot:testMaster:enable -&gt; MyRoot.testMaster.enable
myTest:MyRoot:testMaster:FrameCount -&gt; MyRoot.testMaster.FrameCount
myTest:MyRoot:testMaster:ByteCount -&gt; MyRoot.testMaster.ByteCount
myTest:MyRoot:testMaster:FrameSize -&gt; MyRoot.testMaster.FrameSize
myTest:MyRoot:testMaster:MyFrameGen -&gt; MyRoot.testMaster.MyFrameGen
myTest:MyRoot:testSlave:enable -&gt; MyRoot.testSlave.enable
myTest:MyRoot:testSlave:FrameCount -&gt; MyRoot.testSlave.FrameCount
myTest:MyRoot:testSlave:ByteCount -&gt; MyRoot.testSlave.ByteCount
Running
</pre></div>
</div>
<p>In the second terminal we generate two frames from epics. Commands in
Rogue are exposed as Variables and a caput will initiate the Command
execution. Since our MyFrameGen Command does not take an arg we
pass a value of 0 to keep epics happy.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ caget myTest:MyRoot:testMaster:FrameCount
myTest:MyRoot:testMaster:FrameCount 0

$ caget myTest:MyRoot:testSlave:FrameCount
myTest:MyRoot:testSlave:FrameCount 0

$ caput myTest:MyRoot:testMaster:FrameSize 210
Old : myTest:MyRoot:testMaster:FrameSize 0
New : myTest:MyRoot:testMaster:FrameSize 210

$ caput myTest:MyRoot:testMaster:MyFrameGen 0
Old : myTest:MyRoot:testMaster:MyFrameGen 0
New : myTest:MyRoot:testMaster:MyFrameGen 0

$ caput myTest:MyRoot:testMaster:MyFrameGen 0
Old : myTest:MyRoot:testMaster:MyFrameGen 0
New : myTest:MyRoot:testMaster:MyFrameGen 0

$ caget myTest:MyRoot:testMaster:FrameCount
myTest:MyRoot:testMaster:FrameCount 2

$ caget myTest:MyRoot:testMaster:ByteCount
myTest:MyRoot:testMaster:ByteCount 420

$ caget myTest:MyRoot:testSlave:FrameCount
myTest:MyRoot:testSlave:FrameCount 2

$ caget myTest:MyRoot:testSlave:ByteCount
myTest:MyRoot:testSlave:ByteCount 420
</pre></div>
</div>
</div>
<div class="section" id="testing-with-a-gui">
<h2>Testing With A GUI<a class="headerlink" href="#testing-with-a-gui" title="Permalink to this headline">Â¶</a></h2>
<p>In the last test we will add a locally attached GUI along with EPICS. This will allow
you to experiment with how bot the GUI and EPICS can manipulate variables in parallel.
In this test we start the GUI in the main script with the core Rogue. It is also possible
to start one or more remote GUIs. That process is described in TBD.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Source for myEpicsGuiTest.py</span>

<span class="kn">import</span> <span class="nn">pyrogue</span>
<span class="kn">import</span> <span class="nn">MyWrapper</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pyrogue.protocols.epics</span>
<span class="kn">import</span> <span class="nn">pyrogue.pydm</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">class</span> <span class="nc">TestRoot</span><span class="p">(</span><span class="n">pyrogue</span><span class="o">.</span><span class="n">Root</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyRoot&quot;</span><span class="p">)</span>

        <span class="c1"># Add master and slave devices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyWrapper</span><span class="o">.</span><span class="n">MyCustomMaster</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;testMaster&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MyWrapper</span><span class="o">.</span><span class="n">MyCustomSlave</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;testSlave&quot;</span><span class="p">))</span>

        <span class="c1"># Connect master to slave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testMaster</span> <span class="o">&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">testSlave</span>

        <span class="c1"># Start the tree</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Add Epics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epics</span> <span class="o">=</span> <span class="n">pyrogue</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">epics</span><span class="o">.</span><span class="n">EpicsCaServer</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="s1">&#39;myTest&#39;</span><span class="p">,</span><span class="n">root</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epics</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epics</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>

    <span class="c1"># Override root class stop method to stop epics on exit</span>
    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epics</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="k">with</span> <span class="n">TestRoot</span><span class="p">()</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running&quot;</span><span class="p">)</span>
    <span class="n">pyrogue</span><span class="o">.</span><span class="n">pydm</span><span class="o">.</span><span class="n">runPyDM</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">r</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;MyGui&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can then start the server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python myEpicsGuiTest.py
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../installing/index.html" class="btn btn-neutral float-right" title="Installing &amp; Compiling Rogue" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="wrapper.html" class="btn btn-neutral float-left" title="Wrapping Custom Module With PyRogue Device" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019, SLAC National Accelerator Laboratory.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>